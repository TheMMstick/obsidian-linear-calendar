/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var k=Object.defineProperty;var j=Object.getOwnPropertyDescriptor;var B=Object.getOwnPropertyNames;var O=Object.prototype.hasOwnProperty;var H=(h,i)=>{for(var t in i)k(h,t,{get:i[t],enumerable:!0})},A=(h,i,t,a)=>{if(i&&typeof i=="object"||typeof i=="function")for(let e of B(i))!O.call(h,e)&&e!==t&&k(h,e,{get:()=>i[e],enumerable:!(a=j(i,e))||a.enumerable});return h};var X=h=>A(k({},"__esModule",{value:!0}),h);var K={};H(K,{default:()=>S});module.exports=X(K);var r=require("obsidian"),w="linear-calendar-view",P={dailyNotesFolder:"",dailyNoteFormat:"YYYY-MM-DD",dateFields:["date","created","due"],showFileCreationDates:!0,year:new Date().getFullYear(),weekdayLabels:["M","T","W","T","F","S","S"],monthLabels:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],scaleX:1,scaleY:1,fontScale:1,defaultScaleX:1,defaultScaleY:1,defaultFontScale:1},S=class extends r.Plugin{constructor(){super(...arguments);this.settings=P}async onload(){await this.loadSettings(),this.registerView(w,t=>new C(t,this)),this.addCommand({id:"open-view",name:"Open linear calendar",callback:()=>this.activateView()}),this.addSettingTab(new N(this.app,this)),this.addRibbonIcon("calendar-days","Open linear calendar",()=>{this.activateView()})}async activateView(){let{workspace:t}=this.app,a=null,e=t.getLeavesOfType(w);e.length>0?a=e[0]:(a=t.getLeaf("tab"),a&&await a.setViewState({type:w,active:!0})),a&&t.revealLeaf(a)}async loadSettings(){this.settings=Object.assign({},P,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}},C=class extends r.ItemView{constructor(t,a){super(t);this.events=new Map;this.plugin=a}getViewType(){return w}getDisplayText(){return"Linear calendar"}getIcon(){return"calendar-days"}async onOpen(){await this.loadEvents(),this.render(),this.registerEvent(this.app.vault.on("create",()=>this.refresh())),this.registerEvent(this.app.vault.on("delete",()=>this.refresh())),this.registerEvent(this.app.vault.on("rename",()=>this.refresh())),this.registerEvent(this.app.metadataCache.on("changed",()=>this.refresh()))}async refresh(){await this.loadEvents(),this.render()}async loadEvents(){var a;this.events.clear();let t=this.app.vault.getMarkdownFiles();for(let e of t){let n=await this.extractDatesFromFile(e);for(let l of n){let s=this.dateKey(l);this.events.has(s)||this.events.set(s,[]),(a=this.events.get(s))==null||a.push({title:e.basename,file:e,startDate:l})}}}async extractDatesFromFile(t){let a=[],e=this.plugin.settings,n=this.parseDailyNoteDate(t);n&&a.push(n);let l=this.app.metadataCache.getFileCache(t);if(l!=null&&l.frontmatter)for(let s of e.dateFields){let c=l.frontmatter[s];if(c){let o=this.parseDate(c);o&&a.push(o)}}return e.showFileCreationDates&&a.length===0&&a.push(new Date(t.stat.ctime)),a}parseDailyNoteDate(t){let a=this.plugin.settings,e=a.dailyNotesFolder;if(e&&!t.path.startsWith(e))return null;let n=(0,r.moment)(t.basename,a.dailyNoteFormat,!0);return n.isValid()?n.toDate():null}parseDate(t){if(typeof t=="string"){let a=(0,r.moment)(t);if(a.isValid())return a.toDate()}return t instanceof Date?t:null}dateKey(t){return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`}render(){let t=this.containerEl.children[1];t.empty(),t.addClass("linear-calendar-container");let a=this.plugin.settings.year,e=this.plugin.settings,n=this.calculateMaxColumns(a),l=t.createDiv({cls:"linear-calendar-header"});this.renderYearSelector(l,a),this.renderScaleControls(l);let s=t.createDiv({cls:"linear-calendar-scroll-wrapper"}),c=s.createDiv({cls:"linear-calendar-grid"});c.style.setProperty("--scale-x",String(e.scaleX)),c.style.setProperty("--scale-y",String(e.scaleY)),c.style.setProperty("--font-scale",String(e.fontScale)),this.renderWeekdayHeader(c,n,e.weekdayLabels);for(let o=0;o<12;o++)this.renderMonth(c,a,o,n);this.registerDomEvent(s,"wheel",o=>{if(o.ctrlKey||o.metaKey){o.preventDefault();let g=o.deltaY>0?-.1:.1;o.shiftKey?this.adjustScale("y",g):this.adjustScale("x",g)}})}renderScaleControls(t){let a=t.createDiv({cls:"linear-calendar-scale-controls"}),e=a.createDiv({cls:"linear-calendar-scale-group"});e.createEl("span",{cls:"linear-calendar-scale-label",text:"Width"});let n=e.createEl("button",{cls:"linear-calendar-scale-btn",attr:{"aria-label":"Decrease width"}});n.setText("-"),n.addEventListener("click",()=>this.adjustScale("x",-.2)),e.createEl("span",{cls:"linear-calendar-scale-value",text:`${Math.round(this.plugin.settings.scaleX*100)}%`});let l=e.createEl("button",{cls:"linear-calendar-scale-btn",attr:{"aria-label":"Increase width"}});l.setText("+"),l.addEventListener("click",()=>this.adjustScale("x",.2));let s=a.createDiv({cls:"linear-calendar-scale-group"});s.createEl("span",{cls:"linear-calendar-scale-label",text:"Height"});let c=s.createEl("button",{cls:"linear-calendar-scale-btn",attr:{"aria-label":"Decrease height"}});c.setText("-"),c.addEventListener("click",()=>this.adjustScale("y",-.2)),s.createEl("span",{cls:"linear-calendar-scale-value",text:`${Math.round(this.plugin.settings.scaleY*100)}%`});let o=s.createEl("button",{cls:"linear-calendar-scale-btn",attr:{"aria-label":"Increase height"}});o.setText("+"),o.addEventListener("click",()=>this.adjustScale("y",.2));let g=a.createDiv({cls:"linear-calendar-scale-group"});g.createEl("span",{cls:"linear-calendar-scale-label",text:"Font"});let E=g.createEl("button",{cls:"linear-calendar-scale-btn",attr:{"aria-label":"Decrease font size"}});E.setText("-"),E.addEventListener("click",()=>this.adjustScale("font",-.1)),g.createEl("span",{cls:"linear-calendar-scale-value",text:`${Math.round(this.plugin.settings.fontScale*100)}%`});let u=g.createEl("button",{cls:"linear-calendar-scale-btn",attr:{"aria-label":"Increase font size"}});u.setText("+"),u.addEventListener("click",()=>this.adjustScale("font",.1));let F=a.createEl("button",{cls:"linear-calendar-scale-btn linear-calendar-scale-reset",attr:{"aria-label":"Reset to defaults"}});F.setText("Reset"),F.addEventListener("click",()=>{this.plugin.settings.scaleX=this.plugin.settings.defaultScaleX,this.plugin.settings.scaleY=this.plugin.settings.defaultScaleY,this.plugin.settings.fontScale=this.plugin.settings.defaultFontScale,this.plugin.saveSettings(),this.render()})}adjustScale(t,a){let e=t==="x"?"scaleX":t==="y"?"scaleY":"fontScale",s=Math.max(.5,Math.min(t==="font"?3:5,this.plugin.settings[e]+a));this.plugin.settings[e]=Math.round(s*10)/10,this.plugin.saveSettings(),this.render()}calculateMaxColumns(t){let a=0;for(let e=0;e<12;e++){let n=new Date(t,e,1),l=new Date(t,e+1,0).getDate(),c=(n.getDay()+6)%7+l;c>a&&(a=c)}return a}renderYearSelector(t,a){let e=t.createDiv({cls:"linear-calendar-year-selector"}),n=e.createEl("button",{cls:"linear-calendar-year-btn",attr:{"aria-label":"Previous year"}});n.setText("<"),n.addEventListener("click",()=>{this.plugin.settings.year=a-1,this.plugin.saveSettings(),this.render()});let l=e.createEl("span",{cls:"linear-calendar-year-label",text:String(a)}),s=e.createEl("button",{cls:"linear-calendar-year-btn",attr:{"aria-label":"Next year"}});s.setText(">"),s.addEventListener("click",()=>{this.plugin.settings.year=a+1,this.plugin.saveSettings(),this.render()});let c=e.createEl("button",{cls:"linear-calendar-today-btn",attr:{"aria-label":"Go to current year"}});c.setText("Today"),c.addEventListener("click",()=>{this.plugin.settings.year=new Date().getFullYear(),this.plugin.saveSettings(),this.render()})}renderWeekdayHeader(t,a,e){let n=t.createDiv({cls:"linear-calendar-row linear-calendar-header-row"});n.createDiv({cls:"linear-calendar-month-label"});for(let l=0;l<a;l++){let s=l%7,c=s===5||s===6;n.createDiv({cls:`linear-calendar-header-cell ${c?"linear-calendar-weekend":""}`}).setText(e[s])}}renderMonth(t,a,e,n){let l=this.plugin.settings,s=new Date(a,e,1),c=new Date(a,e+1,0).getDate(),o=(s.getDay()+6)%7,g=t.createDiv({cls:"linear-calendar-row"});g.createDiv({cls:"linear-calendar-month-label"}).setText(l.monthLabels[e]);let u=new Date,Y=a===u.getFullYear()&&e===u.getMonth(),I=u.getDate(),x=g.createDiv({cls:"linear-calendar-days-container"});for(let d=0;d<o;d++){let p=d%7,f=p===5||p===6;x.createDiv({cls:`linear-calendar-cell linear-calendar-empty ${f?"linear-calendar-weekend":""}`})}for(let d=1;d<=c;d++){let f=(o+d-1)%7,V=f===5||f===6,W=Y&&d===I,L=new Date(a,e,d),M=this.dateKey(L),m=this.events.get(M)||[],b=x.createDiv({cls:`linear-calendar-cell ${V?"linear-calendar-weekend":""} ${W?"linear-calendar-today":""} ${m.length>0?"linear-calendar-has-events":""}`,attr:{"data-date":M,"aria-label":`${l.monthLabels[e]} ${d}, ${a}`,tabindex:"0",role:"button"}});if(b.createDiv({cls:"linear-calendar-day-number"}).setText(String(d)),m.length>0){let y=b.createDiv({cls:"linear-calendar-events"});for(let D of m.slice(0,3)){let T=y.createDiv({cls:"linear-calendar-event",attr:{"aria-label":`Open ${D.title}`,tabindex:"0",role:"button"}});T.setText(D.title.substring(0,10)),T.addEventListener("click",v=>{v.stopPropagation(),this.openFile(D.file)}),T.addEventListener("keydown",v=>{(v.key==="Enter"||v.key===" ")&&(v.preventDefault(),v.stopPropagation(),this.openFile(D.file))})}m.length>3&&y.createDiv({cls:"linear-calendar-more"}).setText(`+${m.length-3}`)}b.addEventListener("click",()=>{this.openOrCreateDailyNote(L)}),b.addEventListener("keydown",y=>{(y.key==="Enter"||y.key===" ")&&(y.preventDefault(),this.openOrCreateDailyNote(L))})}let $=o+c;for(let d=$;d<n;d++){let p=d%7,f=p===5||p===6;x.createDiv({cls:`linear-calendar-cell linear-calendar-empty ${f?"linear-calendar-weekend":""}`})}}async openFile(t){await this.app.workspace.getLeaf(!1).openFile(t)}async openOrCreateDailyNote(t){let a=this.plugin.settings,e=(0,r.moment)(t).format(a.dailyNoteFormat),n=a.dailyNotesFolder,l=n?`${n}/${e}.md`:`${e}.md`,s=this.app.vault.getAbstractFileByPath(l);if(s instanceof r.TFile)await this.openFile(s);else try{n&&(this.app.vault.getAbstractFileByPath(n)||await this.app.vault.createFolder(n));let c=await this.app.vault.create(l,"");await this.openFile(c)}catch(c){s=this.app.vault.getAbstractFileByPath(l),s instanceof r.TFile&&await this.openFile(s)}}async onClose(){}},N=class extends r.PluginSettingTab{constructor(i,t){super(i,t),this.plugin=t}display(){let{containerEl:i}=this;i.empty(),new r.Setting(i).setName("Daily notes").setHeading(),new r.Setting(i).setName("Daily notes folder").setDesc("Folder where daily notes are stored (leave empty for vault root)").addText(t=>t.setPlaceholder("daily").setValue(this.plugin.settings.dailyNotesFolder).onChange(async a=>{this.plugin.settings.dailyNotesFolder=a,await this.plugin.saveSettings()})),new r.Setting(i).setName("Daily note format").setDesc("Date format for daily note filenames (moment.js format)").addText(t=>t.setPlaceholder("YYYY-MM-DD").setValue(this.plugin.settings.dailyNoteFormat).onChange(async a=>{this.plugin.settings.dailyNoteFormat=a,await this.plugin.saveSettings()})),new r.Setting(i).setName("Event sources").setHeading(),new r.Setting(i).setName("Date fields").setDesc("Frontmatter fields to check for dates (comma-separated)").addText(t=>t.setPlaceholder("date, created, due").setValue(this.plugin.settings.dateFields.join(", ")).onChange(async a=>{this.plugin.settings.dateFields=a.split(",").map(e=>e.trim()).filter(e=>e.length>0),await this.plugin.saveSettings()})),new r.Setting(i).setName("Show file creation dates").setDesc("Show notes on their creation date if no other date is found").addToggle(t=>t.setValue(this.plugin.settings.showFileCreationDates).onChange(async a=>{this.plugin.settings.showFileCreationDates=a,await this.plugin.saveSettings()})),new r.Setting(i).setName("Display").setHeading(),new r.Setting(i).setName("Weekday labels").setDesc("Labels for weekdays starting Monday (comma-separated)").addText(t=>t.setPlaceholder("M, T, W, T, F, S, S").setValue(this.plugin.settings.weekdayLabels.join(", ")).onChange(async a=>{let e=a.split(",").map(n=>n.trim()).filter(n=>n.length>0);e.length===7&&(this.plugin.settings.weekdayLabels=e,await this.plugin.saveSettings())})),new r.Setting(i).setName("Month labels").setDesc("Labels for months (comma-separated)").addText(t=>t.setPlaceholder("Jan, Feb, Mar, ...").setValue(this.plugin.settings.monthLabels.join(", ")).onChange(async a=>{let e=a.split(",").map(n=>n.trim()).filter(n=>n.length>0);e.length===12&&(this.plugin.settings.monthLabels=e,await this.plugin.saveSettings())})),new r.Setting(i).setName("Default sizes").setHeading(),new r.Setting(i).setName("Default width scale").setDesc("Default cell width scale (50-500%)").addText(t=>t.setPlaceholder("100").setValue(String(Math.round(this.plugin.settings.defaultScaleX*100))).onChange(async a=>{let e=parseInt(a,10);!isNaN(e)&&e>=50&&e<=500&&(this.plugin.settings.defaultScaleX=e/100,await this.plugin.saveSettings())})),new r.Setting(i).setName("Default height scale").setDesc("Default cell height scale (50-500%)").addText(t=>t.setPlaceholder("100").setValue(String(Math.round(this.plugin.settings.defaultScaleY*100))).onChange(async a=>{let e=parseInt(a,10);!isNaN(e)&&e>=50&&e<=500&&(this.plugin.settings.defaultScaleY=e/100,await this.plugin.saveSettings())})),new r.Setting(i).setName("Default font scale").setDesc("Default font size scale (50-300%)").addText(t=>t.setPlaceholder("100").setValue(String(Math.round(this.plugin.settings.defaultFontScale*100))).onChange(async a=>{let e=parseInt(a,10);!isNaN(e)&&e>=50&&e<=300&&(this.plugin.settings.defaultFontScale=e/100,await this.plugin.saveSettings())}))}};
